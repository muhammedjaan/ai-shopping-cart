<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCart 2.0</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* SCANNER SECTION */
        #scanner-section { background: black; padding: 20px 0; }
        #reader { width: 100%; max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; }
        
        /* HIDE THE UGLY STOP BUTTON FROM LIBRARY */
        #reader__dashboard_section_csr button { background: red; color: white; border: none; padding: 5px; margin-top: 10px; }

        /* CART SECTION */
        .cart-section { flex: 1; background: white; padding: 20px; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; margin-top: -20px; z-index: 10; }
        
        h2 { margin: 0 0 10px 0; }
        ul { flex: 1; list-style: none; padding: 0; overflow-y: auto; }
        li { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 1.1rem; }
        
        .total-box { font-size: 1.5rem; font-weight: bold; text-align: center; border-top: 2px solid #333; padding-top: 15px; margin-top: 10px; }
        
        .checkout-btn { background: #28a745; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1.2rem; cursor: pointer; margin-top: 10px; }
        
        /* FEEDBACK MESSAGE */
        #feedback { text-align: center; color: green; font-weight: bold; height: 20px; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div id="scanner-section">
        <div id="reader"></div>
    </div>

    <div class="cart-section">
        <div id="feedback"></div>
        <h2>Your Cart</h2>
        <ul id="cart-list"></ul>
        
        <div class="total-box">Total: $<span id="total-price">0.00</span></div>
        <button class="checkout-btn" onclick="checkout()">Checkout & Print</button>
    </div>

    <audio id="beep" src="https://assets.mixkit.co/active_storage/sfx/701/701-preview.mp3"></audio>

<script>
    // --- 1. CONFIGURATION ---
    const products = {
        "6294011607141": { name: "Lulu Yogurt Drink", price: 2.50 },
        "1234567890123": { name: "Test Item", price: 1.00 }
    };

    let cart = [];
    let total = 0;
    let lastScanTime = 0;

    // --- 2. SCAN SUCCESS FUNCTION ---
    function onScanSuccess(decodedText, decodedResult) {
        // Prevent double scanning (2 second cooldown)
        const now = new Date().getTime();
        if (now - lastScanTime < 2000) return;
        lastScanTime = now;

        // CHECK DATABASE
        let item = products[decodedText];

        // UNKNOWN ITEM RULE ($4.98)
        if (!item) {
            item = { name: "Unrecognized Item", price: 4.98 };
        }

        // ADD TO CART
        cart.push(item);
        total += item.price;

        // UPDATE HTML
        const li = document.createElement("li");
        li.innerHTML = `<span>${item.name}</span> <b>$${item.price.toFixed(2)}</b>`;
        document.getElementById("cart-list").prepend(li);
        document.getElementById("total-price").innerText = total.toFixed(2);

        // FEEDBACK
        document.getElementById("feedback").innerText = `Scanned: ${item.name}`;
        document.getElementById("beep").play().catch(e => console.log("Click page to enable audio"));
        if (navigator.vibrate) navigator.vibrate(200);

        // Clear feedback message after 2s
        setTimeout(() => { document.getElementById("feedback").innerText = ""; }, 2000);
    }

    // --- 3. START THE SCANNER ---
    // This builds the UI automatically!
    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", 
        { 
            fps: 10, 
            qrbox: { width: 250, height: 250 }, // The scanning box size
            aspectRatio: 1.0
        },
        /* verbose= */ false
    );
    
    html5QrcodeScanner.render(onScanSuccess);

    // --- 4. CHECKOUT ---
    function checkout() {
        if(cart.length === 0) return alert("Cart is empty");
        alert("Printing Receipt...\nTotal: $" + total.toFixed(2));
        location.reload();
    }
</script>

</body>
</html>
